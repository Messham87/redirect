<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
  <meta charset="utf-8">
  <script>
    // Function to parse URL hash or query parameters
    function getParams() {
      const params = {};
      // Handle both hash and query parameters (Supabase uses hash by default for email links)
      const parts = window.location.hash.substring(1).split('&').concat(window.location.search.substring(1).split('&'));

      parts.forEach(part => {
        const [key, value] = part.split('=');
        if (key && value) {
          params[decodeURIComponent(key)] = decodeURIComponent(value);
        }
      });
      return params;
    }

    const params = getParams();

    // Construct the deep link URL
    // Make sure 'hopento' matches your scheme in app.json
    // Make sure '/auth/callback' matches the path configured in your React Navigation linking
    const deepLinkBase = 'hopento://auth/callback'; // <--- **UPDATE THIS WITH YOUR SCHEME**
    const deepLinkParams = new URLSearchParams();

    // Pass *all* received parameters to the deep link
    for (const key in params) {
      deepLinkParams.append(key, params[key]);
    }

    const deepLinkUrl = `${deepLinkBase}?${deepLinkParams.toString()}`;

    console.log("Attempting to redirect to:", deepLinkUrl);

    // Attempt to redirect using the deep link
    // Use window.location.replace so the user can't go back to this redirect page
    window.location.replace(deepLinkUrl);

    // Optional: Add a fallback for browsers that don't support the deep link (less common now)
    // Or display a message if the redirect doesn't happen quickly
    setTimeout(() => {
      document.getElementById('message').innerText = "If you are not redirected, please open the app manually.";
    }, 2000); // Show message after 2 seconds if redirect hasn't happened

  </script>
</head>
<body>
  <p id="message">Redirecting to your app...</p>
  <!-- You might want a button here to manually open the app -->
  <!-- <button onclick="window.location.replace(deepLinkUrl)">Open App</button> -->
</body>
</html>
